{% extends "base.html" %}

{% block title %}Dashboard - Water Permit Management System{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card bg-primary text-white">
            <div class="card-body">
                <h5 class="card-title">
                    <i class="fas fa-file-alt me-2"></i>
                    Total Applications
                </h5>
                <h2 class="card-text">{{ applications|length }}</h2>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-success text-white">
            <div class="card-body">
                <h5 class="card-title">
                    <i class="fas fa-check-circle me-2"></i>
                    Approved
                </h5>
                <h2 class="card-text">
                    {{ applications|selectattr('status', 'equalto', 'Approved')|list|length }}
                </h2>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-warning text-white">
            <div class="card-body">
                <h5 class="card-title">
                    <i class="fas fa-clock me-2"></i>
                    Pending
                </h5>
                <h2 class="card-text">
                    {{ applications|selectattr('status', 'equalto', 'Unsubmitted')|list|length }}
                </h2>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-danger text-white">
            <div class="card-body">
                <h5 class="card-title">
                    <i class="fas fa-times-circle me-2"></i>
                    Rejected
                </h5>
                <h2 class="card-text">
                    {{ applications|selectattr('status', 'equalto', 'Rejected')|list|length }}
                </h2>
            </div>
        </div>
    </div>
</div>

<div class="card">
    <div class="card-header bg-white">
        <div class="d-flex justify-content-between align-items-center">
            <h5 class="mb-0">
                <i class="fas fa-list me-2"></i>
                Applications
            </h5>
            <div class="btn-group">
                <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#filterModal">
                    <i class="fas fa-filter me-2"></i>
                    Filter
                </button>
                <button type="button" class="btn btn-outline-primary" id="exportBtn">
                    <i class="fas fa-download me-2"></i>
                    Export
                </button>
            </div>
        </div>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>Permit Number</th>
                        <th>Applicant Name</th>
                        <th>Type</th>
                        <th>Status</th>
                        <th>Submitted Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for application in applications %}
                    <tr>
                        <td>{{ application.permit_number }}</td>
                        <td>{{ application.applicant_name }}</td>
                        <td>{{ application.permit_type }}</td>
                        <td>
                            <span class="badge bg-{{ {
                                'Unsubmitted': 'warning',
                                'Submitted': 'info',
                                'Chairperson Reviewed': 'primary',
                                'Manager Reviewed': 'primary',
                                'Approved': 'success',
                                'Rejected': 'danger'
                            }[application.status] }}">
                                {{ application.status }}
                            </span>
                        </td>
                        <td>{{ application.submitted_at.strftime('%Y-%m-%d') if application.submitted_at else 'N/A' }}</td>
                        <td>
                            <div class="btn-group">
                                <a href="{{ url_for('view_application', id=application.id) }}" class="btn btn-sm btn-outline-primary">
                                    <i class="fas fa-eye"></i>
                                </a>
                                {% if application.status == 'Approved' %}
                                <a href="{{ url_for('print_permit', id=application.id) }}" class="btn btn-sm btn-outline-success">
                                    <i class="fas fa-print"></i>
                                </a>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Filter Modal -->
<div class="modal fade" id="filterModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-filter me-2"></i>
                    Filter Applications
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="filterForm">
                    <div class="mb-3">
                        <label class="form-label">Status</label>
                        <select class="form-select" name="status">
                            <option value="">All</option>
                            <option value="Unsubmitted">Unsubmitted</option>
                            <option value="Submitted">Submitted</option>
                            <option value="Chairperson Reviewed">Chairperson Reviewed</option>
                            <option value="Manager Reviewed">Manager Reviewed</option>
                            <option value="Approved">Approved</option>
                            <option value="Rejected">Rejected</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Permit Type</label>
                        <select class="form-select" name="permit_type">
                            <option value="">All</option>
                            <option value="Urban">Urban</option>
                            <option value="Bulk Water">Bulk Water</option>
                            <option value="Irrigation">Irrigation</option>
                            <option value="Institution">Institution</option>
                            <option value="Industrial">Industrial</option>
                            <option value="Surface Water">Surface Water</option>
                            <option value="Tempering">Tempering</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Date Range</label>
                        <div class="input-group">
                            <input type="date" class="form-control" name="start_date">
                            <span class="input-group-text">to</span>
                            <input type="date" class="form-control" name="end_date">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="applyFilter">Apply Filter</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.getElementById('applyFilter').addEventListener('click', function() {
    const formData = new FormData(document.getElementById('filterForm'));
    const params = new URLSearchParams(formData);
    window.location.href = `${window.location.pathname}?${params.toString()}`;
});

document.getElementById('exportBtn').addEventListener('click', function() {
    // Implementation for exporting to Excel/PDF
    alert('Export functionality to be implemented');
});
</script>
{% endblock %} 